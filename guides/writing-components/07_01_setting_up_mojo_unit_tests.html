<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src/site/apt/guides/writing-components/07_01_setting_up_mojo_unit_tests.apt at 2022-06-09
 | Rendered using Apache Maven Fluido Skin 1.9
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <meta name="author" content="Rahul Thakur" />
    <meta name="date" content="2006-06-27" />
    <title>Plexus &#x2013; Using a Plexus Component from a Maven Mojo.</title>
    <link rel="stylesheet" href="../../css/apache-maven-fluido-1.9.min.css" />
    <link rel="stylesheet" href="../../css/site.css" />
    <link rel="stylesheet" href="../../css/print.css" media="print" />
    <script src="../../js/apache-maven-fluido-1.9.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><a href="http://codehaus-plexus.github.io/" id="bannerLeft"><img src="../../images/plexus-logo-trans.png"  alt="Plexus"/></a></div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
      <li class=""><a href="../../" title="Plexus">Plexus</a><span class="divider">/</span></li>
    <li class="active ">Using a Plexus Component from a Maven Mojo. <a href="https://github.com/codehaus-plexus/codehaus-plexus.github.io/tree/source/src/site/apt/guides/writing-components/07_01_setting_up_mojo_unit_tests.apt"><img src="../../images/accessories-text-editor.png" title="Edit" /></a></li>
        <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2022-06-09</li>
      <li class="pull-right"><a href="http://codehaus-plexus.github.io/" class="externalLink" title="Plexus">Plexus</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Plexus</li>
    <li><a href="../../index.html" title="Overview"><span class="none"></span>Overview</a></li>
   <li class="nav-header">Old IoC Documentation</li>
    <li><a href="../../" title="Books"><span class="icon-chevron-down"></span>Books</a>
     <ul class="nav nav-list">
      <li><a href="../../writing-components-trail/index.html" title="Writing Components"><span class="none"></span>Writing Components</a></li>
     </ul></li>
    <li><a href="../../" title="Guides"><span class="icon-chevron-down"></span>Guides</a>
     <ul class="nav nav-list">
      <li><a href="../../guides/quick-start/getting-started.html" title="Quick Start"><span class="none"></span>Quick Start</a></li>
      <li><a href="../../guides/writing-components/00_index.html" title="Writing Plexus Components"><span class="none"></span>Writing Plexus Components</a></li>
      <li><a href="../../guides/developer-guide/index.html" title="Developer Guide"><span class="none"></span>Developer Guide</a></li>
     </ul></li>
    <li><a href="../../" title="Reference"><span class="icon-chevron-down"></span>Reference</a>
     <ul class="nav nav-list">
      <li><a href="../../ref/why-use-components.html" title="Why Use Components?"><span class="none"></span>Why Use Components?</a></li>
      <li><a href="../../ref/plexus-descriptor.html" title="Plexus Descriptor"><span class="none"></span>Plexus Descriptor</a></li>
      <li><a href="../../guides/developer-guide/configuration/component-descriptor.html" title="Component Descriptor"><span class="none"></span>Component Descriptor</a></li>
      <li><a href="../../ref/component-configuration.html" title="Component Configuration"><span class="none"></span>Component Configuration</a></li>
      <li><a href="../../ref/technical-articles.html" title="Technical Articles"><span class="none"></span>Technical Articles</a></li>
      <li><a href="../../ref/available-components.html" title="Available Components"><span class="none"></span>Available Components</a></li>
      <li><a href="../../faq.html" title="FAQs"><span class="none"></span>FAQs</a></li>
     </ul></li>
   <li class="nav-header">Community</li>
    <li><a href="https://groups.google.com/g/mojohaus-dev" class="externalLink" title="Mailing Lists"><span class="none"></span>Mailing Lists</a></li>
    <li><a href="../../get-involved.html" title="Get Involved"><span class="none"></span>Get Involved</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="../../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
   <li class="nav-header">Plexus Projects</li>
    <li><a href="../../modello/" title="Modello"><span class="none"></span>Modello</a></li>
    <li><a href="../../plexus-classworlds/" title="Plexus Classworlds"><span class="none"></span>Plexus Classworlds</a></li>
    <li><a href="../../" title="Plexus Components"><span class="icon-chevron-down"></span>Plexus Components</a>
     <ul class="nav nav-list">
      <li><a href="../../plexus-archiver/" title="Plexus Archiver"><span class="none"></span>Plexus Archiver</a></li>
      <li><a href="../../plexus-cli/" title="Plexus CLI"><span class="none"></span>Plexus CLI</a></li>
      <li><a href="../../plexus-compiler/" title="Plexus Compiler"><span class="none"></span>Plexus Compiler</a></li>
      <li><a href="../../plexus-digest/" title="Plexus Digest"><span class="none"></span>Plexus Digest</a></li>
      <li><a href="../../plexus-i18n/" title="Plexus i18n"><span class="none"></span>Plexus i18n</a></li>
      <li><a href="../../plexus-interactivity/" title="Plexus Interactivity"><span class="none"></span>Plexus Interactivity</a></li>
      <li><a href="../../plexus-interpolation/" title="Plexus Interpolation"><span class="none"></span>Plexus Interpolation</a></li>
      <li><a href="../../plexus-io/" title="Plexus IO"><span class="none"></span>Plexus IO</a></li>
      <li><a href="../../plexus-languages/" title="Plexus Languages"><span class="none"></span>Plexus Languages</a></li>
      <li><a href="../../plexus-resources/" title="Plexus Resources"><span class="none"></span>Plexus Resources</a></li>
      <li><a href="../../plexus-swizzle/" title="Plexus Swizzle"><span class="none"></span>Plexus Swizzle</a></li>
      <li><a href="../../plexus-velocity/" title="Plexus Velocity"><span class="none"></span>Plexus Velocity</a></li>
     </ul></li>
    <li><a href="../../" title="Plexus Parent POMs"><span class="icon-chevron-down"></span>Plexus Parent POMs</a>
     <ul class="nav nav-list">
      <li><a href="../../plexus-pom/" title="Plexus"><span class="none"></span>Plexus</a></li>
      <li><a href="../../plexus-components/" title="Plexus Components"><span class="none"></span>Plexus Components</a></li>
     </ul></li>
    <li><a href="../../plexus-utils/" title="Plexus Utils"><span class="none"></span>Plexus Utils</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
<form id="search-form" action="https://www.google.com/search" method="get" >
  <input value="http://codehaus-plexus.github.io/" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script>asyncJs( 'https://cse.google.com/brand?form=search-form' )</script>
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<p><code>The contents of this document are a work in progress</code></p><section>
<h2><a name="Setting_up_unit_tests_for_Monitor_Mojo"></a>Setting up unit tests for Monitor Mojo </h2>
<p>Unit testing allows us to test out our Mojo implmentation without requiring a project to be set up. </p>
<p>Maven provides a <b>Plugin Test Harness</b> to enable testing of Mojos. </p>
<p>Some relatively comprehensive notes on the Maven Plugin Harness are available <a class="externalLink" href="http://docs.codehaus.org/display/MAVEN/Maven+Plugin+Harness">here</a>.</p><section>
<h3><a name="Adding_test_sources_directory_to_the_project"></a>Adding test sources directory to the project </h3>
<p>This step is needed as the Mojo Archetype (as of this writing) does not sets up test folder when we created our Maven plugin project.</p>
<ol style="list-style-type: decimal">
<li>To the project root add a directory <code>src/test/java</code>. We will create our unit tests under this location. </li>
<li>To the project root add a director <code>src/test/resources</code>. This directory will hold resources that we use for Mojo testing. </li></ol></section><section>
<h3><a name="Adding_plugin_test_harness_dependency"></a>Adding plugin test harness dependency</h3>
<ol style="list-style-type: decimal">
<li>First thing we need to do is to add the Maven plugin test harness dependency to our Plugin's <code>pom.xml</code>. Locate the <code>pom.xml</code> and add the harness dependency as follows.
<div class="source"><pre class="prettyprint linenums">  &lt;dependencies&gt;
    .
    .
    .
   &lt;dependency&gt;
      &lt;groupId&gt;org.apache.maven.shared&lt;/groupId&gt;
      &lt;artifactId&gt;maven-plugin-testing-harness&lt;/artifactId&gt;
      &lt;version&gt;1.0-beta-1&lt;/version&gt;
      &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;</pre></div></li>
<li>Next we need to update depdendency references in our Eclipse project settings to make the plugin testing harness available. To do this run the following from the command prompt from the plugin project's directory.
<div class="source"><pre class="prettyprint linenums"> mvn eclipse:clean eclipse:eclipse</pre></div></li>
<li>Refresh the Eclipse project by selecting the project root folder and pressing 'F5' key. 
<p>You will see that the plugin testing harness dependency and the test directory that we added in the previous step are now updated. </p></li></ol></section><section>
<h3><a name="Writing_our_Mojo_unit_tests"></a>Writing our Mojo unit tests</h3>
<ol style="list-style-type: decimal">
<li>Create a new package <code>org.codehaus.plexus</code> to create our test in. Note that we create the package with the same name that our Mojo implementation resides in. This is a convenience to test out methods on Mojo which may have access specifiers that allow access only from within same package.</li>
<li>We write a couple of tests to ensure that our Mojo instance is being retrieved as expected, and to test that it executes without errors for a valid list of websites.
<p>Our test source looks as follows: </p>
<div class="source"><pre class="prettyprint linenums">public class MonitorMojoTest
    extends AbstractMojoTestCase
{

    public void testMojoLookup()
        throws Exception
    {
        File pluginXml = new File( getBasedir(), &quot;src/test/resources/unit/plugin-config.xml&quot; );
        MonitorMojo mojo = (MonitorMojo) lookupMojo( &quot;monitor&quot;, pluginXml );
        assertNotNull( mojo );
    }

    public void testMojoExecution()
        throws Exception
    {
        File pluginXml = new File( getBasedir(), &quot;src/test/resources/unit/plugin-config.xml&quot; );
        MonitorMojo mojo = (MonitorMojo) lookupMojo( &quot;monitor&quot;, pluginXml );
        assertNotNull( mojo.getWebsites() );
        assertEquals( 1, mojo.getWebsites().size() );
        assertNotNull( mojo.getMonitor() );
        try
        {
            mojo.execute();
        }
        catch ( Exception e )
        {
            fail( &quot;Unexpected exception with test data.&quot; );
        }
    }
}</pre></div></li>
<li>We set up a test configuration for the Mojo under <code>src/test/resources/unit/plugin-config.xml</code> (yes, that's the file that we refer to in the test above!).
<div class="source"><pre class="prettyprint linenums">&lt;project&gt;
  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.codehaus.plexus&lt;/groupId&gt;
        &lt;artifactId&gt;plexus-website-monitor-plugin&lt;/artifactId&gt;
        &lt;configuration&gt;
          &lt;websites&gt;
            &lt;website&gt;http://plexus.codehaus.org/&lt;/website&gt;
          &lt;/websites&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;
&lt;/project&gt;</pre></div></li>
<li>Also our Mojo implementation is now updated to be as below:
<div class="source"><pre class="prettyprint linenums">public class MonitorMojo
    extends AbstractMojo
{

    /**
     * List of websites to monitor.
     * @parameter 
     */
    private List websites;

    /**
     * The website monitor component instance that will be injected 
     * by the Plexus runtime.
     * @component 
     */
    private WebsiteMonitor monitor;

    public void execute()
        throws MojoExecutionException, MojoFailureException
    {
        if ( !hasWebsites() )
        {
            if ( getLog().isWarnEnabled() )
                getLog().warn( &quot;No websites specified to be monitored.&quot; );
            return;
        }

        if ( getLog().isDebugEnabled() )
            showMonitoredWebsites();

        monitor.addWebsites( websites );
        try
        {
            monitor.monitor();
        }
        catch ( Exception e )
        {
            if ( getLog().isErrorEnabled() )
                getLog().error( &quot;Error monitoring websites.&quot;, e );
        }
    }

    private void showMonitoredWebsites()
    {
        getLog().debug( &quot;Monitoring following websites:&quot; );
        for ( Iterator it = websites.iterator(); it.hasNext(); )
        {
            String website = (String) it.next();
            getLog().debug( &quot;\t&quot; + website );
        }
    }

    /**
     * Determines if websites were specified to the Mojo.
     * 
     * @return &lt;code&gt;true&lt;/code&gt; if there were websites specified.
     */
    private boolean hasWebsites()
    {
        return ( null != websites &amp;&amp; websites.size() &gt; 0 );
    }

    /**
     * Returns the list of websites.&lt;p&gt;
     * &lt;em&gt;Not public API. For unit tests only.&lt;/em&gt;
     * 
     * @return List of websites specified via Mojo configuration.
     */
    protected List getWebsites()
    {
        return this.websites;
    }

    /**
     * Returns the {@link WebsiteMonitor} component instance.&lt;p&gt;
     * &lt;em&gt;Not public API. For unit tests only.&lt;/em&gt;
     * 
     * @return the {@link WebsiteMonitor} instance.
     */
    protected WebsiteMonitor getMonitor()
    {
        return monitor;
    }

}</pre></div></li>
<li>Let's run the test and see what happens. You can run the test from within your favourite IDE, or from command prompt by typing
<div class="source"><pre class="prettyprint linenums"> mvn clean test </pre></div>
<p>At this point, the Mojo test should run without any failures. </p>
<p>Great! You have just hooked your Plexus component successfully to a Maven plugin.</p>
<p>For more information on developing and using Maven plugins, please refer to <a class="externalLink" href="http://maven.apache.org/guides/plugin/guide-java-plugin-development.html">Guide to Developing Java Plugins</a></p></li></ol></section></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>&#169;      2001&#x2013;2022
<a href="https://codehaus-plexus.github.io/">Codehaus Plexus</a>
</p>
        </div>
      </div>
    </footer>
  </body>
</html>